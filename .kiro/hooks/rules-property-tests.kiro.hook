{
  "enabled": true,
  "name": "Property-Based Test Suggestions for Rules",
  "description": "When files in core/rules containing deterministic logic (dice rolling, combat resolution) are saved, automatically suggest property-based test cases using kotest's checkAll to ensure correctness across all input ranges",
  "version": "1",
  "when": {
    "type": "fileEdited",
    "patterns": [
      "core/rules/**/*.kt"
    ]
  },
  "then": {
    "type": "askAgent",
    "prompt": "Analyze the saved file in core/rules for deterministic logic such as dice rolling, combat resolution, damage calculation, saving throws, or condition effects. For each deterministic function or method found:\n\n1. Identify the function signature and its purpose\n2. Determine the input parameter ranges and edge cases\n3. Suggest property-based test cases using kotest's `checkAll` that verify:\n   - Output is always within valid ranges (e.g., d20 returns 1-20)\n   - Deterministic behavior with seeded RNG (same seed = same result)\n   - Mathematical invariants (e.g., damage >= 0, AC calculations)\n   - Edge cases (min/max values, boundary conditions)\n\nFormat suggestions as ready-to-use kotest test code with:\n- Appropriate Arb generators (Arb.int(), Arb.long(), custom Arbs)\n- Clear test descriptions\n- Assertions using kotest matchers (shouldBe, shouldBeInRange, etc.)\n- Seeded RNG where applicable for determinism\n\nFocus on rules engine components that must be 100% deterministic and reproducible."
  }
}